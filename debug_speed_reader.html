<!DOCTYPE html>
<html>
<head>
    <title>Speed Reader Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .speed-reader-section { border: 1px solid #ccc; padding: 20px; margin: 20px 0; }
        .word-display { 
            border: 2px solid #007bff; 
            padding: 20px; 
            text-align: center; 
            font-size: 2rem; 
            margin: 10px 0; 
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .primary-btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            margin: 5px;
        }
        .secondary-btn { 
            background: #6c757d; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            margin: 5px;
        }
        .speed-btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            cursor: pointer; 
            margin: 0 5px;
        }
        .quiz-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin: 10px 0;
        }
        .quiz-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.5;
        }
        .reading-progress { width: 100%; height: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Speed Reader Debug Test</h1>
    
    <!-- Speed Reader Section -->
    <section id="speed-reader-section" class="speed-reader-section" 
             data-content="This is a test article with multiple words to test the speed reader functionality. It should display one word at a time when the user clicks start reading."
             data-user-wpm="250">

        <h2>Speed Reader</h2>

        <div class="speed-reader-container">
            <div id="word-display" class="word-display">
                Click Start to begin reading
            </div>

            <progress id="progress-bar" class="reading-progress" value="0" max="100">
                0%
            </progress>

            <div class="speed-controls">
                <button id="speed-decrease" class="speed-btn" type="button">-</button>
                <span class="speed-display">
                    <span id="current-speed">250</span> WPM
                </span>
                <button id="speed-increase" class="speed-btn" type="button">+</button>
            </div>

            <div class="reader-controls">
                <button id="start-pause-btn" class="primary-btn" type="button">
                    Start Reading
                </button>
                <button id="reset-btn" class="secondary-btn" type="button">
                    Reset
                </button>
            </div>
        </div>

        <!-- Quiz Section -->
        <div class="quiz-section">
            <button id="start-quiz-btn" class="quiz-btn" type="button">
                Start Quiz
            </button>
            <small>Complete the reading first, then test your comprehension!</small>
        </div>
    </section>
    
    <script>
        console.log('Debug: Script starting...');
        
        // Global translation function (simplified)
        window._ = function(key) {
            const translations = {
                'reading_finished': 'Reading finished!',
                'click_start_reading': 'Click Start to begin reading',
                'start_reading': 'Start Reading',
                'pause_reading': 'Pause'
            };
            return translations[key] || key;
        };

        // Get elements
        const section = document.getElementById('speed-reader-section');
        const wordDisplay = document.getElementById('word-display');
        const startBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const speedDisplay = document.getElementById('current-speed');
        const speedIncBtn = document.getElementById('speed-increase');
        const speedDecBtn = document.getElementById('speed-decrease');
        const progressBar = document.getElementById('progress-bar');

        console.log('Debug: Elements found:', {
            section: !!section,
            wordDisplay: !!wordDisplay,
            startBtn: !!startBtn,
            resetBtn: !!resetBtn,
            speedDisplay: !!speedDisplay,
            progressBar: !!progressBar
        });

        if (!section || !wordDisplay || !startBtn) {
            console.error('Debug: Essential elements missing');
            return;
        }

        // Get content
        const content = section.dataset.content;
        if (!content) {
            console.error('Debug: No content found');
            wordDisplay.textContent = 'No content available';
            return;
        }

        // Split into words
        const words = content.replace(/\s+/g, ' ').trim().split(' ').filter(w => w.length > 0);
        console.log('Debug: Found', words.length, 'words');

        // State
        let currentIndex = 0;
        let isRunning = false;
        let intervalId = null;
        let wpm = parseInt(speedDisplay.textContent) || 250;

        // Quiz state
        let quizEnabled = false;

        function showWord() {
            console.log('Debug: showWord called, currentIndex:', currentIndex);
            if (currentIndex < words.length) {
                const word = words[currentIndex];
                wordDisplay.textContent = word;
                console.log('Debug: Showing word:', word);

                const progress = ((currentIndex + 1) / words.length) * 100;
                if (progressBar) {
                    progressBar.value = progress;
                }
                currentIndex++;
            } else {
                wordDisplay.textContent = _('reading_finished');
                stopReading();
                enableQuiz();
                console.log('Debug: Reading finished, quiz enabled');
            }
        }

        function startReading() {
            console.log('Debug: startReading called');
            if (intervalId) clearInterval(intervalId);
            const interval = 60000 / wpm;
            intervalId = setInterval(showWord, interval);
            startBtn.textContent = _('pause_reading');
            isRunning = true;
            console.log('Debug: Started at', wpm, 'WPM, interval:', interval);
        }

        function stopReading() {
            console.log('Debug: stopReading called');
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            startBtn.textContent = _('start_reading');
            isRunning = false;
        }

        function resetReading() {
            console.log('Debug: resetReading called');
            stopReading();
            currentIndex = 0;
            wordDisplay.textContent = _('click_start_reading');
            if (progressBar) progressBar.value = 0;
            disableQuiz();
        }

        function enableQuiz() {
            console.log('Debug: enableQuiz called');
            quizEnabled = true;
            const startQuizBtn = document.getElementById('start-quiz-btn');
            if (startQuizBtn) {
                startQuizBtn.disabled = false;
                startQuizBtn.style.opacity = '1';
                startQuizBtn.style.cursor = 'pointer';
                const quizSection = document.querySelector('.quiz-section small');
                if (quizSection) {
                    quizSection.textContent = 'Great! You can now take the quiz.';
                    quizSection.style.color = 'green';
                }
            }
        }
        
        function disableQuiz() {
            console.log('Debug: disableQuiz called');
            quizEnabled = false;
            const startQuizBtn = document.getElementById('start-quiz-btn');
            if (startQuizBtn) {
                startQuizBtn.disabled = true;
                startQuizBtn.style.opacity = '0.5';
                startQuizBtn.style.cursor = 'not-allowed';
                const quizSection = document.querySelector('.quiz-section small');
                if (quizSection) {
                    quizSection.textContent = 'Complete the reading first, then test your comprehension!';
                    quizSection.style.color = '';
                }
            }
        }

        // Event listeners
        startBtn.addEventListener('click', function () {
            console.log('Debug: Start/Pause clicked, isRunning:', isRunning);
            if (isRunning) {
                stopReading();
            } else {
                if (currentIndex >= words.length) {
                    resetReading();
                }
                startReading();
            }
        });

        if (resetBtn) {
            resetBtn.addEventListener('click', resetReading);
        }

        if (speedIncBtn) {
            speedIncBtn.addEventListener('click', () => {
                wpm = Math.min(1000, wpm + 25);
                speedDisplay.textContent = wpm;
                console.log('Debug: Speed increased to', wpm);
            });
        }

        if (speedDecBtn) {
            speedDecBtn.addEventListener('click', () => {
                wpm = Math.max(50, wpm - 25);
                speedDisplay.textContent = wpm;
                console.log('Debug: Speed decreased to', wpm);
            });
        }

        // Quiz button
        const startQuizBtn = document.getElementById('start-quiz-btn');
        if (startQuizBtn) {
            startQuizBtn.addEventListener('click', function() {
                if (quizEnabled) {
                    alert('Quiz would start here! (Quiz functionality working)');
                } else {
                    alert('Please complete the reading first!');
                }
            });
        }

        // Initially disable the quiz
        disableQuiz();

        console.log('Debug: Initialization complete');
    </script>
</body>
</html>