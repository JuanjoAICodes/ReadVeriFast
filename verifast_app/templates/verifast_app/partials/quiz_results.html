{% load i18n %}

<div id="quiz-container" class="quiz-results">
    <h3>{% trans "Quiz Results" %}</h3>
    
    <div class="score-display">
        <div class="score-circle {% if score >= 70 %}score-pass{% else %}score-fail{% endif %}">
            <span class="score-number">{{ score }}%</span>
        </div>
    </div>
    
    <div class="result-message">
        <p>{{ messages.main_message|default:"Quiz completed!" }}</p>
        {% if result_type == 'passed' %}
        <p class="success-message">{% trans "Congratulations! You passed the quiz." %}</p>
        {% else %}
        <p class="info-message">{% trans "Keep practicing to improve your comprehension." %}</p>
        {% endif %}
    </div>
    
    {% if xp_earned > 0 %}
    <div class="xp-earned">
        <p><strong>{% trans "XP Earned" %}: +{{ xp_earned }}</strong></p>
    </div>
    {% endif %}
    
    {% if user_can_comment %}
    <div class="comment-unlock-message">
        <p class="success-message">
            <strong>{% trans "Commenting Unlocked!" %}</strong><br>
            {% trans "You can now participate in discussions below." %}
        </p>
    </div>
    {% endif %}
    
    {% if result_type == 'passed' and messages and messages.title %}
    <div class="result-heading">
        <h4>{{ messages.title }}</h4>
    </div>
    {% endif %}

    {% if result_type == 'passed' and feedback and feedback|length > 0 %}
    <div x-data="{open: false}">
        <button class="secondary-btn" @click="open=!open" style="margin:0.5rem 0;">
            <span x-show="!open">{% trans "Show answer feedback" %}</span>
            <span x-show="open">{% trans "Hide answer feedback" %}</span>
        </button>
        <div class="feedback-panel" x-show="open" x-cloak>
            <h5>{% trans "Review your incorrect answers" %}</h5>
            <ul class="feedback-list">
                {% for item in feedback %}
                <li class="feedback-item">
                    <div class="question"><strong>{% trans "Question:" %}</strong> {{ item.question }}</div>
                    <div class="your-answer"><strong>{% trans "Your answer:" %}</strong> {{ item.user_answer|default:'—' }}</div>
                    <div class="correct-answer"><strong>{% trans "Correct answer:" %}</strong> {{ item.correct_answer|default:'—' }}</div>
                    {% if item.explanation %}
                    <div class="explanation"><strong>{% trans "Explanation:" %}</strong> {{ item.explanation }}</div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <div class="quiz-actions">
        <button onclick="location.reload()" class="primary-btn">
            {% trans "Continue Reading" %}
        </button>
    </div>
</div>

<style>
.quiz-results {
    text-align: center;
    padding: 2rem;
}

.score-display {
    margin: 2rem 0;
}

.score-circle {
    display: inline-block;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    border: 4px solid;
}

.score-circle.score-pass {
    background: #28a745;
    border-color: #1e7e34;
}

.score-circle.score-fail {
    background: #dc3545;
    border-color: #c82333;
}

.score-number {
    font-size: 2rem;
    font-weight: bold;
    color: white;
}

.result-message {
    font-size: 1.1rem;
    margin: 1rem 0;
}

.success-message {
    color: #28a745;
    font-weight: bold;
}

.info-message {
    color: #6c757d;
}

.xp-earned {
    background: #ffc107;
    color: #212529;
    padding: 1rem;
    border-radius: 6px;
    margin: 1rem 0;
    font-size: 1.1rem;
}

.comment-unlock-message {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
    padding: 1rem;
    border-radius: 6px;
    margin: 1rem 0;
}

.feedback-panel {
    text-align: left;
    background: #f8f9fa;
    border: 1px solid #e2e3e5;
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem auto;
    max-width: 800px;
}
.feedback-list {
    list-style: none;
    padding: 0;
    margin: 0;
}
.feedback-item {
    padding: 0.75rem 0;
    border-bottom: 1px solid #e9ecef;
}
.feedback-item:last-child {
    border-bottom: none;
}
.feedback-item .question {
    margin-bottom: 0.25rem;
}
.feedback-item .explanation {
    margin-top: 0.25rem;
    color: #495057;
}

.quiz-actions {
    margin-top: 2rem;
}
</style>