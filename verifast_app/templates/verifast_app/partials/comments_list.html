<!-- Comments List Partial -->
{% load i18n %}

<div id="comments-list">
    {% for comment in comments %}
    <div class="comment">
        <div class="comment-header">
            <strong>{{ comment.user.username }}</strong>
            <span class="comment-date">{{ comment.timestamp|date:"M j, Y g:i A" }}</span>
        </div>
        <div class="comment-content">
            {{ comment.content }}
        </div>
        <div class="comment-actions">
            <!-- Interaction counts display - Using pre-calculated counts from optimized query -->
            <div class="interaction-counts">
                {% if comment.bronze_count > 0 %}
                <span class="interaction-count bronze">ğŸ¥‰ {{ comment.bronze_count }}</span>
                {% endif %}
                {% if comment.silver_count > 0 %}
                <span class="interaction-count silver">ğŸ¥ˆ {{ comment.silver_count }}</span>
                {% endif %}
                {% if comment.gold_count > 0 %}
                <span class="interaction-count gold">ğŸ¥‡ {{ comment.gold_count }}</span>
                {% endif %}
            </div>

            <!-- Interaction buttons for authenticated users -->
            {% if user.is_authenticated %}
            <div class="interaction-buttons">
                <button class="interaction-btn bronze" hx-post="{% url 'verifast_app:comment_interact' comment.id %}"
                    hx-vals='{"type": "BRONZE"}' hx-target="#comments-list" hx-swap="outerHTML"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                    ğŸ¥‰ {% trans "Bronze" %} (5 XP)
                </button>
                <button class="interaction-btn silver" hx-post="{% url 'verifast_app:comment_interact' comment.id %}"
                    hx-vals='{"type": "SILVER"}' hx-target="#comments-list" hx-swap="outerHTML"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                    ğŸ¥ˆ {% trans "Silver" %} (15 XP)
                </button>
                <button class="interaction-btn gold" hx-post="{% url 'verifast_app:comment_interact' comment.id %}"
                    hx-vals='{"type": "GOLD"}' hx-target="#comments-list" hx-swap="outerHTML"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                    ğŸ¥‡ {% trans "Gold" %} (30 XP)
                </button>
            </div>
            {% endif %}
        </div>

        <!-- Nested replies -->
        {% if comment.replies.exists %}
        <div class="comment-replies">
            {% for reply in comment.replies.all %}
            <div class="comment reply">
                <div class="comment-header">
                    <strong>{{ reply.user.username }}</strong>
                    <span class="comment-date">{{ reply.timestamp|date:"M j, Y g:i A" }}</span>
                </div>
                <div class="comment-content">
                    {{ reply.content }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% empty %}
    <p class="no-comments">{% trans "No comments yet. Be the first to share your thoughts!" %}</p>
    {% endfor %}
</div>