{# Macro para renderizar una tarjeta de art칤culo horizontal con Flexbox #}
{% macro render_article_card(article) %}
<article style="padding: 0; margin-bottom: 1.5rem;">
    <div style="display: flex; align-items: stretch; gap: 1rem;">
        
        <!-- Columna de la Imagen -->
        {% if article.image_url %}
        <div style="flex: 0 0 200px;">  <!-- No crece, no se encoge, base de 200px -->
            <a href="{{ url_for('core.article_detail', article_id=article.id) }}">
                <img src="{{ article.image_url }}" alt="Imagen de {{ article.title }}" 
                     style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--border-radius) 0 0 var(--border-radius);">
            </a>
        </div>
        {% endif %}

        <!-- Columna del Contenido -->
        <div style="flex-grow: 1; padding: 1rem; display: flex; flex-direction: column;">
            <h4>
                <a href="{{ url_for('core.article_detail', article_id=article.id) }}">
                    {{ article.title }}
                </a>
            </h4>
            <p style="margin-bottom: 0.5rem;">
                <small>
                    {% if article.is_user_submitted %}
                        <span title="{{ _('Community Pick') }}">游녻</span>
                    {% else %}
                        <span title="{{ _('From our feed') }}">游닗</span>
                    {% endif %}
                    {{ _('Submitted by') }}: {{ article.author.email if article.author else 'System' }} | {{ _('Date') }}: {{ article.timestamp.strftime('%Y-%m-%d') }}
                </small>
            </p>
            <footer style="margin-top: auto;"> <!-- Empuja los tags hacia abajo -->
                {% for tag in article.tags %}
                    <a href="{{ url_for('core.articles_by_tag', tag_name=tag.name) }}" class="secondary outline" style="padding: 0.1rem 0.4rem; font-size: 0.7rem;">#{{ tag.name }}</a>
                {% endfor %}
            </footer>
        </div>

    </div>
</article>
{% endmacro %}

{# Macro para renderizar un elemento de lista de art칤culo con Pico.css #}
{% macro render_article_list_item(article) %}
<article>
    <header>
        <div style="display: flex; justify-content: space-between; align-items: baseline;">
            <a href="{{ url_for('core.article_detail', article_id=article.id) }}">
                <strong>{{ article.title or 'Art칤culo sin t칤tulo' }}</strong>
            </a>
            <small>{{ article.timestamp.strftime('%d %b, %Y') }}</small>
        </div>
    </header>
    <footer>
        {% for tag in article.tags.limit(4) %}
            <a href="{{ url_for('core.articles_by_tag', tag_name=tag.name) }}" style="margin-right: 0.5rem;"><small>#{{ tag.name }}</small></a>
        {% endfor %}
    </footer>
</article>
{% endmacro %}

{# Macro para renderizar un bot칩n de "Compartir" con la Web Share API #}
{% macro render_share_button(article) %}
{# 1. Renderizar el HTML del bot칩n #}
<button id="share-button">{{ _('Share') }}</button>

{# 2. Renderizar el bloque <script> con la l칩gica de la Web Share API #}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const shareButton = document.getElementById('share-button');

    // Solo proceder si el bot칩n existe en el DOM (puede que la macro no se use siempre)
    if (shareButton) {
        // Comprobar si la Web Share API est치 disponible en el navegador
        if (navigator.share) {
            // A침adir el evento de clic al bot칩n
            shareButton.addEventListener('click', async () => {
                try {
                    // Llamar a navigator.share() con los datos del art칤culo
                    await navigator.share({
                        title: `{{ article.title | e }}`, {# T칤tulo del art칤culo, escapado para seguridad #}
                        text: `{{ _('춰Prueba a leer este art칤culo y supera mi puntuaci칩n en VeriFast!') }}`, {# Mensaje traducible #}
                        url: `{{ url_for('core.article_detail', article_id=article.id, _external=True) }}` {# URL completa del art칤culo #}
                    });
                } catch (err) {
                    // Manejar errores, ignorando si el usuario simplemente cancela la acci칩n
                    if (err.name !== 'AbortError') {
                        console.error('Error al intentar compartir:', err);
                    }
                }
            });
        } else {
            // Si la Web Share API NO est치 disponible, ocultar el bot칩n
            shareButton.style.display = 'none';
        }
    }
});
</script>
{% endmacro %}