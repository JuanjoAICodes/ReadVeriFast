<!doctype html>
<html lang="{{ get_locale() }}" data-theme="{{ current_user.theme if current_user.is_authenticated else 'auto' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>{{ title }} - VeriFast</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='CSS/style.css') }}">
</head>
<body>

  <header class="container">
    <nav>
      <ul>
        <li><strong><a href="{{ url_for('core.landing_page') }}">VeriFast</a></strong></li>
      </ul>
      <ul>
        <li><a href="{{ url_for('core.articles') }}">{{ _('Articles') }}</a></li>
        <li><a href="{{ url_for('core.submit_article') }}">{{ _('Submit Article') }}</a></li>

        <!-- Language Switcher and User Actions pushed to the right -->
        <li style="margin-left: auto;">
          <details role="list" dir="rtl">
            <summary aria-haspopup="listbox" role="button" class="secondary outline">{{ g.locale.upper() }}</summary>
            <ul role="listbox">
              {% for lang in config.LANGUAGES %}
                {% if lang != g.locale %}
                  <li><a href="{{ url_for('core.set_language', lang=lang) }}">{{ lang.upper() }}</a></li>
                {% endif %}
              {% endfor %}
            </ul>
          </details>
        </li>

        {% if current_user.is_authenticated %}
          {% if current_user.is_admin %}
            <!-- MenÃº desplegable para el Admin -->
            <li>
                <details role="list" dir="rtl">
                    <summary aria-haspopup="listbox" role="button">{{ _('Admin') }}</summary>
                    <ul role="listbox">
                        <li><a href="{{ url_for('core.profile') }}">{{ _('My Profile') }}</a></li>
                        <li><a href="{{ url_for('core.dashboard') }}">{{ _('Dashboard') }}</a></li>
                    </ul>
                </details>
            </li>
          {% else %}
            <!-- Enlace simple para usuario normal -->
            <li><a href="{{ url_for('core.profile') }}">{{ _('My Profile') }}</a></li>
          {% endif %}
          <li><a href="{{ url_for('auth.logout') }}" role="button" class="secondary">{{ _('Logout') }}</a></li>
        {% else %}
          <li><a href="{{ url_for('auth.login') }}">{{ _('Login') }}</a></li>
          <li><a href="{{ url_for('auth.register') }}" role="button">{{ _('Register') }}</a></li>
        {% endif %}
      </ul>
    </nav>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
      <article class="flash-message" style="background-color: var(--card-background-color); border-color: var(--card-border-color);">
        <p>{{ message }}</p>
      </article>
      {% endfor %}
    {% endif %}
    {% endwith %}
    
    {% block content %}{% endblock %}
  </main>

  <footer class="container" style="text-align: center; margin-top: 4rem; padding-bottom: 2rem;">
    <hr>
    <small>
        VeriFast &copy; 2025 |
        <a href="mailto:verifast01@gmail.com?subject=VeriFast Feedback/Suggestion">{{ _('Suggestions or Bugs?') }}</a>
    </small>
  </footer>

</body>
</html>