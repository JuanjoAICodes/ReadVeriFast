{% extends "base.html" %}

{% block title %}{{ _('Quiz Results!') }}{% endblock %}

{% block content %}
<style>
    .container { max-width: 800px; margin: 20px auto; padding: 0 20px; text-align: center; }
    .xp-gain { color: #28a745; font-weight: bold; }
    .feedback-section { text-align: left; margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    .feedback-item { margin-bottom: 1.5em; }
    .user-answer { color: #dc3545; }
    .correct-answer { color: #17a2b8; }
    .actions { margin-top: 40px; display: flex; justify-content: center; gap: 15px; }
    .original-link { margin-top: 20px; font-size: 0.9em; }
</style>

<div class="container">
    <!-- 1. Mensaje de Felicitación y Gamificación -->
    <h1>{{ _('Congratulations!') }}</h1>
    <h2>{{ _('You have earned') }} <span class="xp-gain">{{ xp_earned }} XP</span></h2>
    <p class="lead">{{ _('Your total XP is now:') }} {{ total_xp }}</p>

    <hr>

    <!-- 2. Feedback Correctivo (solo para errores) -->
    {% set errors = evaluation_details | selectattr('is_correct', 'equalto', false) | list %}
    {% if errors %}
        <div class="feedback-section">
            <h3>{{ _('Error Review') }}</h3>
            {% for detail in errors %}
                <div class="feedback-item">
                    <p><strong>{{ _('Question:') }}</strong> {{ detail.question_text }}</p>
                    <p class="user-answer">{{ _('Your answer:') }} {{ detail.user_answer }}</p>
                    <p class="correct-answer">{{ _('Correct answer:') }} {{ detail.correct_answer }}</p>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- 3. Acciones Principales -->
    <h3>{{ _('What to do now?') }}</h3>
    {% if related_article %}
        <a href="{{ url_for('core.article_detail', article_id=related_article.id) }}" role="button" class="primary">{{ _('Next Article') }}</a>
    {% endif %}
    <a href="{{ url_for('core.index') }}" role="button" class="secondary">{{ _('Main Page') }}</a>

    <!-- 4. Enlace al artículo original -->
    <p class="original-link">
        <a href="{{ article.url }}" target="_blank">{{ _('View original article') }}</a>
    </p>
</div>
{% endblock %}